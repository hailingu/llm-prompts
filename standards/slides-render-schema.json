{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "slides-render-schema-v1",
  "title": "Slides Semantic IR (Intermediate Representation) Schema",
  "description": "Shared interface contract between ppt-content-planner (producer), ppt-visual-designer (styler), ppt-creative-director (reviewer), and ppt-specialist (renderer). All agents MUST conform to this schema.",
  "version": "1.0.0",

  "definitions": {

    "kpi_item": {
      "type": "object",
      "description": "A single KPI metric card — rendered as a Material kpi_card.",
      "required": ["label", "value"],
      "properties": {
        "label":  { "type": "string", "description": "Metric name, e.g. '效率'" },
        "value":  { "type": ["string", "number"], "description": "Current value, e.g. '≥98%' or 98" },
        "unit":   { "type": "string", "description": "Optional unit, e.g. '%', 'kW', 'ms'" },
        "delta":  { "type": "string", "description": "Trend indicator, e.g. '↑5%', '→ stable'" },
        "status": { "type": "string", "enum": ["normal", "warning", "critical"], "default": "normal" }
      }
    },

    "decision_item": {
      "type": "object",
      "description": "A decision request — rendered as a decision card or row in decision matrix.",
      "required": ["id", "title"],
      "properties": {
        "id":          { "type": "string", "description": "Decision identifier, e.g. 'D1'" },
        "title":       { "type": "string", "description": "Decision title" },
        "description": { "type": "string", "description": "Brief elaboration" },
        "owner":       { "type": "string", "description": "Decision owner / approver" },
        "budget":      { "type": "string", "description": "Budget range, e.g. '$0.5-1.5M'" },
        "priority":    { "type": "string", "enum": ["P0", "P1", "P2"], "description": "Priority level" },
        "timeline":    { "type": "string", "description": "Expected timeline, e.g. '立即', 'Q1'" },
        "status":      { "type": "string", "enum": ["pending", "approved", "rejected"], "default": "pending" }
      }
    },

    "comparison_item": {
      "type": "object",
      "description": "A single item in a comparison — rendered as a column in comparison table or card.",
      "required": ["label", "attributes"],
      "properties": {
        "label":      { "type": "string", "description": "Item name, e.g. 'EV 快充'" },
        "attributes": {
          "type": "object",
          "description": "Key-value pairs for comparison dimensions",
          "additionalProperties": { "type": ["string", "number"] }
        },
        "highlight": { "type": "boolean", "default": false, "description": "Emphasize this item" }
      }
    },

    "timeline_item": {
      "type": "object",
      "description": "A milestone or phase — rendered as a dot on the timeline.",
      "required": ["phase", "period"],
      "properties": {
        "phase":       { "type": "string", "description": "Phase name, e.g. 'Phase 1: 立项'" },
        "period":      { "type": "string", "description": "Time range, e.g. '0–3 个月'" },
        "description": { "type": "string", "description": "Key deliverables" },
        "milestone":   { "type": "string", "description": "Gate / acceptance criteria" },
        "status":      { "type": "string", "enum": ["planned", "active", "completed"], "default": "planned" }
      }
    },

    "callout_item": {
      "type": "object",
      "description": "A highlighted callout box — rendered as a left-bordered Material callout.",
      "required": ["text"],
      "properties": {
        "text":   { "type": "string", "description": "Callout message" },
        "accent": { "type": "string", "enum": ["primary", "secondary", "tertiary", "error"], "default": "primary" },
        "icon":   { "type": "string", "description": "Optional emoji or icon prefix" }
      }
    },

    "table_data": {
      "type": "object",
      "description": "Structured table — rendered as a Material data_table.",
      "required": ["headers", "rows"],
      "properties": {
        "headers": { "type": "array", "items": { "type": "string" } },
        "rows": {
          "type": "array",
          "items": {
            "type": "array",
            "items": { "type": ["string", "number"] }
          }
        }
      }
    },

    "action_item": {
      "type": "object",
      "description": "A next-step action — rendered as a checklist card.",
      "required": ["text"],
      "properties": {
        "text":     { "type": "string", "description": "Action description" },
        "owner":    { "type": "string", "description": "Responsible person/team" },
        "deadline": { "type": "string", "description": "Target date" }
      }
    },

    "risk_item": {
      "type": "object",
      "description": "A risk entry — rendered in risk matrix or list.",
      "required": ["risk", "probability", "impact"],
      "properties": {
        "risk":       { "type": "string", "description": "Risk description" },
        "probability":{ "type": "string", "enum": ["low", "medium", "high"] },
        "impact":     { "type": "string", "enum": ["low", "medium", "high"] },
        "mitigation": { "type": "string", "description": "Mitigation strategy" },
        "owner":      { "type": "string" },
        "priority":   { "type": "string", "enum": ["P0", "P1", "P2", "P3"] }
      }
    },

    "components": {
      "type": "object",
      "description": "Structured component data for the slide. The renderer uses these to fill the layout beyond simple bullets. At least one component type should be present for every slide to avoid sparse rendering.",
      "properties": {
        "kpis":             { "type": "array", "items": { "$ref": "#/definitions/kpi_item" } },
        "decisions":        { "type": "array", "items": { "$ref": "#/definitions/decision_item" } },
        "comparison_items": { "type": "array", "items": { "$ref": "#/definitions/comparison_item" } },
        "timeline_items":   { "type": "array", "items": { "$ref": "#/definitions/timeline_item" } },
        "callouts":         { "type": "array", "items": { "$ref": "#/definitions/callout_item" } },
        "table_data":       { "$ref": "#/definitions/table_data" },
        "action_items":     { "type": "array", "items": { "$ref": "#/definitions/action_item" } },
        "risks":            { "type": "array", "items": { "$ref": "#/definitions/risk_item" } }
      },
      "additionalProperties": false
    },

    "slide": {
      "type": "object",
      "required": ["slide_id", "title", "slide_type", "content"],
      "properties": {
        "slide_id":   { "type": "integer", "minimum": 1 },
        "title":      { "type": "string", "description": "Assertion-style slide title" },
        "slide_type": {
          "type": "string",
          "enum": ["title", "bullet-list", "two-column", "comparison", "data-heavy", "matrix", "flowchart", "timeline", "gantt", "call_to_action", "decision", "technical", "process"],
          "description": "Determines layout skeleton"
        },
        "slide_role": {
          "type": "string",
          "enum": ["situation", "complication", "answer", "evidence", "action", "next_steps"],
          "description": "SCQA role in narrative arc"
        },
        "content": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Textual bullets — rendered as body text. Should have 2-5 items."
        },
        "components": { "$ref": "#/definitions/components" },
        "speaker_notes": { "type": "object" },
        "visual": { "type": "object" },
        "metadata": { "type": "object" }
      }
    }
  },

  "type": "object",
  "required": ["deck_title", "slides"],
  "properties": {
    "deck_title": { "type": "string" },
    "author":     { "type": "string" },
    "date":       { "type": "string" },
    "language":   { "type": "string" },
    "slides": {
      "type": "array",
      "items": { "$ref": "#/definitions/slide" }
    }
  },

  "_rendering_contract": {
    "description": "Two-layer dispatch: (1) slide_type → layout skeleton (grid regions), (2) components → fill page regions with structured data. content[] provides fallback bullets. Slides without components degrade to bullet-only layout.",
    "layer_1_dispatch": "RENDERERS[slide_type] → determines region splits (full-width, two-column, etc.)",
    "layer_2_dispatch": "COMPONENT_RENDERERS[component_type] → fills regions (kpi cards, decision matrix, comparison table, timeline dots, callout bars, data table, action checklist, risk matrix)",
    "fallback": "If no components present, render content[] as bullets in the body region.",
    "density_rule": "Every slide SHOULD have at least one component OR a visual with placeholder_data. Slides with only 2 bullets and no component/visual are flagged as 'sparse' by QA."
  }
}
